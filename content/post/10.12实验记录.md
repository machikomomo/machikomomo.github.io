---
author: "momo"
date: 2022-10-12
title: "实验记录"
categories: [
    "笔记",
]

---

## 公共数据集（肺炎）（up!!!）

新冠肺炎数据集

https://github.com/v7labs/covid-19-xray-dataset

https://darwin.v7labs.com/v7-labs/covid-19-chest-x-ray-dataset

每个图像包含：肺炎类型的标签（病毒、细菌、真菌、健康/无）



亚齐老师之前的一篇：

Multiscale Attention Guided Network for COVID-19 Diagnosis Using Chest X-ray Images

https://arxiv.org/abs/2012.02278

数据集A：包括来自[15]的90个COVID-19和来自[17]的168个其他肺炎病例（新冠和非新冠的其他肺炎）

数据集B：从[47]和[17]中选出的，增加了健康这一类别（新冠，非新冠的其他肺炎，健康）

数据集C：作者主要操作的数据集，其中包括COVID-19和细粒度的肺炎分类（新冠、病毒、细菌、健康）



kaggle肺炎数据集

https://www.kaggle.com/datasets/paultimothymooney/chest-xray-pneumonia（细粒度分类问题）





## ODIR-5k（眼底）

原比赛：https://odir2019.grand-challenge.org/

数据集构成：这是一个由5,000名病人组成的结构化眼科数据集。提供了**八种眼病类别的多标签图像级注释，包括糖尿病、青光眼、白内障、老年黄斑变性（AMD）、高血压、近视、正常和其他疾病。每个病人可能包含一个或多个疾病标签。**模型需要开发自动眼部疾病分类的方法。以左右眼的彩色眼底图像作为输入（可以使用其他提供的信息，如患者年龄、性别），目标是将患者分为八类。

|          | 训练集 | 测试集 |
| -------- | ------ | ------ |
| 患者数量 | 3500   | 500    |
| 样本数量 | 7000   | 1000   |

| 正常 | 糖尿病 | 青光眼 | 白内障 | AMD  | 高血压 | 近视 | 其他疾病/异常 |
| ---- | ------ | ------ | ------ | ---- | ------ | ---- | ------------- |
| 1140 | 1128   | 215    | 212    | 164  | 103    | 174  | 979           |

评估指标：参与者必须提交所有测试数据的八类分类结果。对于每个类别，分类概率（值从 0.0 到 1.0）表示被诊断为相应类别的患者的风险。 提交的内容根据三个指标进行评分：[kappa score ](https://en.wikipedia.org/wiki/Cohen's_kappa)、  [F-1 socre](https://en.wikipedia.org/wiki/F1_score) 和 [AUC value](https://en.wikipedia.org/wiki/Receiver_operating_characteristic#Area_under_the_curve)。 阈值为 0.5。

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/12791656585757_.pic.jpg)

## 下载地址

1.原比赛网址链接失效，kaggle下载（附带kaggle预处理版本的数据集）：https://www.kaggle.com/datasets/andrewmvd/ocular-disease-recognition-odir5k/code （预处理图片：只有训练图片，一共6392条记录，512大小，但是csv文件里面，对多标签图片只打了一个标签）

2.https://www.heywhale.com/mw/dataset/5e95e3ede7ec38002d0351f6

3.https://www.icode9.com/content-2-869077.html

已下载至论文积累/odir-5k文件夹。

## 训练标注

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-07-215.03.28.png)

3500个病人。包含患者年龄，患者性别信息。id为288的患者对应的左右眼图片分别是288_left、288_right。每个患者都有2张图片，没有缺失。描述关键词：中度非增殖性视网膜病变、轻度非增殖性视网膜病变、严重非增殖性视网膜病变、正常眼底图、视网膜激光手术后，中度非增殖性视网膜病变、视网膜激光手术后，糖尿病性视网膜病变、视网膜内微血管异常等，但是这个描述性关键词和八个病变的标签没有直接联系（左右眼不同的描述组合，可能标签是一样的）。有多标签、有单标签数据。每个标签的数量，是不均衡的（单标签里面，N和D的比较多；多标签里面，G和O就比较多）。一位患者对应两张图片，对应一组标签。两个norm，最后的标签是norm；一个norm，那么对病变图片的标签就是这个患者的标签；如果两只眼睛都是病变，那其实每张图片的标签是不确定的·。

## 训练图片

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-07-215.10.28.png)

数据分析 https://www.kaggle.com/code/ulafiliz/ocular-disease-detection-data-analysis ：

1.对于给定数据集中的女性和男性的比较，男性的糖尿病视网膜病变略高，尽管男性眼底样本被诊断为 "正常 "的较多。
2.近视更可能发生在年轻男性身上。
3.大多数疾病的年龄分布是正常的。
4.女性比男性更有可能在早期被诊断出青光眼。

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-07-215.44.05.png)

## ODIR-5k有关的论文

#### CLASSIFICATION OF OCULAR DISEASES EMPLOYING ATTENTION-BASED UNILATERAL AND BILATERAL FEATURE WEIGHTING AND FUSION

2020 IEEE 17th International Symposium on Biomedical Imaging (ISBI)

基于注意力的融合网络（AUBNet），将患者自动分类到相应的疾病类别中。具体来说，AUBNet由一个特征提取模块（FEM）、一个特征融合模块（FFM）和一个分类模块（CFM）组成。FEM从患者的双侧眼底照片中独立提取两个特征向量。通过FFM，进行两级特征加权和融合，以准备双眼的特征表示。最后，多标签分类由CFM进行。

这篇文章重在阐述它的FFM即特征融合这一部分，出发点是给左右眼的特征向量不同的权重，主要是在说明这个权重的计算是怎么计算的。这里的注意力就是用线性层（全连接层（权重、偏置）实现）。最终得到的向量，经过2个全连接层做分类。2048-512-8。最后用的loss函数是BCE二元交叉熵损失函数。

三个指标：kappa得分，f1得分，auc。最后加一个加权总分（平均）。

作者将数据集分成3部分，1167、1167和1166名患者。三折实验。

特征融合的部分，做了对比实验。相加、通道连接、乘法和提出的进行对比。特征提取器分别使用resnet18、34、50、101。训练的时候，图像resize成512*512；训练过程中，random crop成448大小。测试时候用的是center crop。用的SGD优化器。学习率策略：The poly learning rate decay policy is used with an initial learning rate of 0.007, power of 0.9, and epoch of 50.

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-07-204.12.22.png)

第二个消融实验。只有一次注意力融合：把中间紫色部分（只做一阶融合）的向量，用于分类。接CFM。只有两次的融合：用计算出的beta权重和最前面的红灰向量做加权相加。两个融合结合：本文最早提出的方法。发现最后一种效果是最好的。

为了验证注意力的权重是不是正确，分类标签是在病人层面上给出的，个别眼睛有诊断关键词。根据这些关键词，我们只能区分眼睛是否受到影响，而不能确定具体的眼部疾病。为了简化结果的解释，我们将200个只有一只眼睛受影响的病人的学习权重可视化。总的来说，患病的眼睛得到的权重更大。而平均权重也存在明显的差异——患病的眼睛权重比正常眼睛的权重要高。

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-07-204.38.34.png)

作者对CFM这个模块没有详细说，sigmoid+bceloss。https://zhuanlan.zhihu.com/p/500347063

论文无代码。





#### CCT-Net: Category-Invariant Cross-Domain Transfer for Medical Single-to-Multiple Disease Diagnosis

2021 ICCV

类别不变的领域迁移。单疾病诊断-多疾病诊断

1.将糖尿病视网膜病变扩展到识别多种眼部疾病。2.将胶质瘤识别扩展到其他脑肿瘤的诊断。

从带有精细注释的单一疾病诊断中学习到的知识，可以被转移到改善没有注释的多种相关疾病的诊断中。源领域需要有像素级别的标注，并且是单一标签。然后目标域是没有标注的，多标签。只知道图像级的疾病类别。

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-07-205.53.11.png)

本文重点：1. 设计了一个特定领域的任务学习模块，以学习领域的变量特征，同时保留两个领域之间的疾病差异。提出了一种CWP全局汇集方法，以获得比其他全局汇集操作更好的类激活图（CAMs）。2. 以不同类别的粗略热图为条件，我们提出了CIFR区块来构建CCTNet，以定位相应疾病的更多鉴别性区域。类别不变的特征使其能够从源域转移到目标域。此外，这种重新定义的特征也有助于提高最终分类的性能。3.实验评估是在两个流行的医学成像任务中进行的。首先，我们将眼底图像的DR诊断扩展到多种眼部疾病的诊断，如青光眼和高血压。第二，利用脑部MRI扫描的胶质瘤分割来改善其他肿瘤的分割和分类性能，如脑膜瘤和垂体瘤。实验结果证明了我们方法的有效性。

本文任务：（从overall开始看），作者的目标是不光光提升目标领域对于图像类别的诊断，还有疾病的定位。

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-07-206.07.10.png)

DSE （Domain specific encoder）：

两个领域共享卷积（Conv）参数，以约束编码器学习领域不变的表征。领域特定批量归一化（BN）来加强对领域不变特征的学习。为了构建DSE，我们采用DenseNet-121[24]作为骨干。在每个Conv层之后，不同领域的BN层被分别学习。

除了获得不同疾病的初步分类结果外，DSE还能计算不同类别的粗略热图。在图像分类任务中，仅使用图像级标签的弱监督方法[8, 50]通常采用类激活图（CAM）[55]来计算定位每个类别的粗略热图。一个特定类别的CAM表明网络用来识别该类别的鉴别性图像区域，并可用于解释网络做出的预测决定。这种定位能力是由基本全局平均/最大集合（GAP/GMP）层实现的。虽然GAP和GMP已被广泛使用，但它们是不可训练的，而且CAM可能无法定位最具有鉴别力的区域。Log-Sum-Exp（LSE）池化[43]引入了一个超参数γ，作为最大池化和平均池化之间的一个可调节选项。然而，LSE池仍然是不可优化的，并且存在过流或欠流问题。

在这项工作中，我们提出了一种可训练的CWP全局池化方法，以更好的定位性能增强原始CAM。源域和目标域的任务学习。尽管最初的基于CWP的CAM已经摒弃了大面积的不相关区域来区分正确的疾病，但其粗略的热图仍然包含一些来自噪声或错误分类的干扰信息。在这项工作中，我们的目标是将这些粗略的热图重新细化为细化的像素级预测，以划定更多的鉴别区域，并将这种重新细化的能力从源域转移到目标域。请注意，CAM可能不是最好的弱监督定位方法[8]，但这不是这项工作的主要关切。我们将在今后的工作中专门研究这一点，以增强CCT-Net的功能。

CCT-Net堆叠了多组CIFR块。

分类结果如下（高于上文）

论文无代码。

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-07-219.57.25.png)





其他论文

https://www.x-mol.com/paper/search/q?option=odir%E6%95%B0%E6%8D%AE%E9%9B%86



![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-10-134.53.42.png)



![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-10-134.51.40.png)



![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-10-134.51.59.png)







**[基于R-CNN+LSTM模型和NCAR特征选择的眼底图像眼科疾病检测的有效且稳健的方法](https://www.x-mol.com/paperRedirect/1466480909038288896)**

Optimized convolution neural network based multiple eye disease detection

![](https://halfbit.oss-cn-hangzhou.aliyuncs.com/2022-10-134.52.03.png)
